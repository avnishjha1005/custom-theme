{%- comment -%}
  Integrated Header Drawer: 
  1) L1 Horizontal Pills 
  2) L2 List with Arrows 
  3) L3 Slide-in Drill-down
  4) Dynamic Breadcrumb Path Label
{%- endcomment -%}

<header-drawer data-breakpoint="tablet">
  <details id="Details-menu-drawer-container" class="menu-drawer-container">
    <summary class="header__icon header__icon--menu header__icon--summary link focus-inset" aria-label="{{ 'sections.shop_the_look.view_product' | t }}">
      <span>
        {{- 'icon-hamburger.svg' | inline_asset_content -}}
        {{- 'icon-close.svg' | inline_asset_content -}}
      </span>
    </summary>

    <div id="menu-drawer" class="gradient menu-drawer motion-reduce" tabindex="-1">
      <div class="menu-drawer__inner-container">
        
        {% comment %} 1. Header Area with Back Button and Close {% endcomment %}
        <div class="drawer-header-actions">
          <button class="drawer-back-btn is-hidden" id="Drawer-Back-Btn" aria-label="Back">
            <span class="arrow-icon">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
            </span>
          </button>
          <button class="drawer-close-btn" id="Drawer-Close-Btn" aria-label="Close">
            <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="1.2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>

        {% comment %} 2. Horizontal L1 Pill Navigation {% endcomment %}
        <nav class="drawer-l1-nav">
          <div class="l1-nav-inner" id="L1-Pill-Container">
            {%- for link in linklist.links -%}
              <button type="button" 
                class="pill-item {% if forloop.first %}is-active{% endif %}" 
                data-l1-index="{{ forloop.index }}"
                data-original-title="{{ link.title | escape }}">
                {{ link.title | escape }}
              </button>
            {%- endfor -%}
          </div>
        </nav>

        {% comment %} 3. Main Content Area (Panels) {% endcomment %}
        <div class="menu-drawer__main-content">
          {%- for l1_link in linklist.links -%}
            <div class="drawer-panel {% if forloop.first %}is-active{% endif %}" data-panel-l1="{{ forloop.index }}">
              
              <ul class="drawer-links-list" role="list">
                {%- for l2_link in l1_link.links -%}
                  <li class="drawer-item-container">
                    <button type="button" class="drawer-link-btn"
                      {% if l2_link.links != blank %}
                        data-drill-down 
                        data-target="Panel-{{ forloop.parentloop.index }}-{{ forloop.index }}"
                        data-path="{{ l1_link.title | escape }} / {{ l2_link.title | escape }}"
                      {% else %}
                        onclick="window.location.href='{{ l2_link.url }}'"
                      {% endif %}>
                      
                      <span class="link-text">{{ l2_link.title | escape }}</span>
                      
                      {%- if l2_link.links != blank -%}
                        <span class="arrow-icon">
                          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </span>
                      {%- endif -%}
                    </button>

                    {% comment %} 4. L3 Slide-in Nested Panel {% endcomment %}
                    {%- if l2_link.links != blank -%}
                      <div class="drawer-panel-nested" id="Panel-{{ forloop.parentloop.index }}-{{ forloop.index }}">
                        <ul class="drawer-links-list" role="list">
                          {%- for l3_link in l2_link.links -%}
                            <li>
                              <a href="{{ l3_link.url }}" class="drawer-link-btn">
                                {{ l3_link.title | escape }}
                              </a>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
                    {%- endif -%}
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endfor -%}
        </div>

      </div>
    </div>
  </details>
</header-drawer>

<style>
  /* Layout */
  .menu-drawer {
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: #fff;
  }
  
  .drawer-header-actions {
    display: flex;
    justify-content: space-between;
    padding: 15px 10px;
    align-items: center;
  }

  .drawer-back-btn, .drawer-close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 10px;
  }

  /* 1. L1 Horizontal Pills */
  .drawer-l1-nav {
    border-bottom: 1px solid #f0f0f0;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .drawer-l1-nav::-webkit-scrollbar { display: none; }

  .l1-nav-inner {
    display: flex;
    padding: 10px 16px;
    gap: 8px;
  }

  .pill-item {
    white-space: nowrap;
    background: #f4f4f4;
    border: 1px solid transparent;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pill-item.is-active {
    background: #000;
    color: #fff;
  }

  /* 2. Main Content & Transitions */
  .menu-drawer__main-content {
    flex: 1;
    position: relative;
    overflow: hidden;
  }

  .drawer-panel {
    display: none;
    padding: 20px 16px;
    height: 100%;
  }

  .drawer-panel.is-active {
    display: block;
  }

  .drawer-links-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .drawer-link-btn {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 0;
    background: none;
    border: none;
    font-size: 16px;
    text-align: left;
    color: #000;
    text-decoration: none;
    cursor: pointer;
    border-bottom: 1px solid #f9f9f9;
  }

  /* 3. L3 Drill Down Panel */
  .drawer-panel-nested {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    padding: 0 16px;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    visibility: hidden;
    z-index: 10;
  }

  .drawer-panel-nested.is-open {
    transform: translateX(0);
    visibility: visible;
  }

  .is-hidden { display: none; }
</style>

<script>
  class HeaderDrawerCustom extends HTMLElement {
    constructor() {
      super();
      this.backBtn = this.querySelector('#Drawer-Back-Btn');
      this.closeBtn = this.querySelector('#Drawer-Close-Btn');
      this.pillBtns = this.querySelectorAll('.pill-item');
      this.drillBtns = this.querySelectorAll('[data-drill-down]');
      this.panels = this.querySelectorAll('.drawer-panel');
      this.nestedPanels = this.querySelectorAll('.drawer-panel-nested');
      
      this.init();
    }

    init() {
      // 1. Level 1 Pill Swapping
      this.pillBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          this.resetToL1();
          
          this.pillBtns.forEach(b => b.classList.remove('is-active'));
          btn.classList.add('is-active');
          
          this.panels.forEach(p => p.classList.remove('is-active'));
          const targetPanel = this.querySelector(`[data-panel-l1="${btn.dataset.l1Index}"]`);
          if (targetPanel) targetPanel.classList.add('is-active');
        });
      });

      // 2. Drill Down (L2 to L3)
      this.drillBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          const targetId = btn.dataset.target;
          const nestedPanel = this.querySelector(`#${targetId}`);
          const activePill = this.querySelector('.pill-item.is-active');

          if (nestedPanel && activePill) {
            nestedPanel.classList.add('is-open');
            activePill.innerText = btn.dataset.path; // Update Label to "Shop / Brand"
            this.backBtn.classList.remove('is-hidden');
          }
        });
      });

      // 3. Back Button
      this.backBtn.addEventListener('click', () => this.resetToL1());

      // 4. Close Drawer
      this.closeBtn.addEventListener('click', () => {
        this.querySelector('details').removeAttribute('open');
        this.resetToL1();
      });
    }

    resetToL1() {
      this.nestedPanels.forEach(p => p.classList.remove('is-open'));
      this.backBtn.classList.add('is-hidden');
      
      // Revert pill text to original
      this.pillBtns.forEach(btn => {
        btn.innerText = btn.dataset.originalTitle;
      });
    }
  }

  customElements.define('header-drawer', HeaderDrawerCustom);
</script>