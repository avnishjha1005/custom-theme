{%- doc -%}
  ... (same documentation as before)
{%- enddoc -%}

{%- liquid
  assign class = class | strip
  assign style = style | strip
  
  # Check for nesting: This is a simplified check. 
  # If this snippet is called within a capture that is then passed as 'slides' to another, 
  # it's considered a child.
  assign is_child = false
  if nested == true
    assign is_child = true
  endif
-%}

<slideshow-component
  {% if ref != blank %}ref="{{ ref }}"{% endif %}
  class="slideshow-wrapper {{ class }}"
  data-is-child="{{ is_child }}"
  {% if autoplay == true %}autoplay="{{ autoplay_speed }}" aria-live="polite"{% endif %}
  initial-slide="{{ initial_slide | default: 0 }}"
  {% if auto_hide_controls %}auto-hide-controls{% endif %}
  {% unless infinite == false %}infinite{% endunless %}
  {{ attributes }}
  style="{{ style }}"
>
  {% if header != blank %}{{ header }}{% endif %}

  <slideshow-container ref="slideshowContainer" class="swiper-container">
    {% if show_arrows and disabled != true %}
      {% render 'slideshow-arrows', icon_style: icon_style, arrows_position: arrows_position %}
    {% endif %}

    {% comment %} 
      Swiper Structure: 
      1. Container (scroller) -> class "swiper"
      2. Wrapper -> class "swiper-wrapper"
      3. Slides -> class "swiper-slide" (needs to be applied in the block rendering the slides)
    {% endcomment %}
    
    <div 
      ref="scroller" 
      class="swiper"
      {% if slide_size %}data-size="{{ slide_size }}"{% endif %}
    >
      <div class="swiper-wrapper">
        {{ slides }}
      </div>
    </div>

    {% if slideshow_arrows and disabled != true %}
      {{ slideshow_arrows }}
    {% endif %}
  </slideshow-container>

  <div ref="dotsContainer" class="swiper-pagination"></div>
  {{ controls }}
</slideshow-component>