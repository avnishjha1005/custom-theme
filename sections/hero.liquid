{% liquid
  assign slides = section.blocks | where: 'type', 'slide'
  assign media_count = slides.size
  assign media_count_mobile = slides.size
  assign media_image_desktop_class = 'hero__image hero__image--desktop'
  
  # Responsive logic
  assign media_width_desktop = '100vw'
  assign media_width_mobile = '100vw'
  
  assign sizes = '(min-width: 750px) ' | append: media_width_desktop | append: ', ' | append: media_width_mobile
  assign widths = '832, 1200, 1600, 1920, 2560, 3840'
  assign sizes_mobile = media_width_mobile
  assign mobile_widths = '416, 600, 800, 1200, 1600'
  assign fetch_priority = 'auto'
  if section.index == 1
    assign fetch_priority = 'high'
  endif
%}

{% capture media %}
  {%- if media_count > 0 -%}
    {%- for block in slides -%}
      {%- comment -%} DESKTOP MEDIA {%- endcomment -%}
      {%- if block.settings.image != blank -%}
        {{
          block.settings.image
          | image_url: width: 3840
          | image_tag:
            width: block.settings.image.width,
            widths: widths,
            height: block.settings.image.height,
            alt: block.settings.image.alt,
            class: media_image_desktop_class,
            sizes: sizes,
            fetchpriority: fetch_priority,
            data-testid: 'hero-desktop-image'
        }}
      {%- else -%}
        {{ 'hero-apparel-1' | placeholder_svg_tag: 'hero__image hero__image--desktop' }}
      {%- endif -%}

      {%- comment -%} MOBILE MEDIA {%- endcomment -%}
      {%- if block.settings.image_mobile != blank -%}
        {{
          block.settings.image_mobile
          | image_url: width: 1600
          | image_tag:
            width: block.settings.image_mobile.width,
            widths: mobile_widths,
            height: block.settings.image_mobile.height,
            alt: block.settings.image_mobile.alt,
            class: 'hero__image hero__image--mobile',
            sizes: sizes_mobile,
            fetchpriority: fetch_priority,
            data-testid: 'hero-mobile-image'
        }}
      {%- endif -%}
    {%- endfor -%}
  {%- else -%}
    {{ 'hero-apparel-1' | placeholder_svg_tag: 'hero__image' }}
  {%- endif -%}
{% endcapture %}

{% capture media_blurred %}
  {%- for block in slides -%}
    {%- if block.settings.image != blank -%}
      {{
        block.settings.image
        | image_url: width: 3840
        | image_tag:
          width: block.settings.image.width,
          widths: widths,
          height: block.settings.image.height,
          alt: '',
          class: media_image_desktop_class,
          sizes: sizes
      }}
    {%- endif -%}
  {%- endfor -%}
{% endcapture %}

<div
  id="Hero-{{ section.id }}"
  class="hero color-{{ section.settings.color_scheme }}{% if section.blocks.size == 0 and section.settings.section_height == 'auto' %} hero--no-blocks-auto-height{% endif %}"
  style="
    --hero-border-style: {{ section.settings.border }};
    --hero-border-width: {{ section.settings.border_width }}px;
    --hero-border-opacity: {{ section.settings.border_opacity }}%;
    --blur-opacity: {{ section.settings.reflection_opacity | divided_by: 100.0 }};
    {% if section.settings.section_height == 'custom' %}
      --hero-min-height: {{ section.settings.section_height_custom }}svh;
    {% elsif section.settings.section_height == "full-screen" %}
       --hero-min-height: 100svh;
    {% else %}
      --hero-min-height: var(--section-height-{{ section.settings.section_height }});
    {% endif %}
  "
>
  {% if section.settings.blurred_reflection %}
      <div
        class="hero__blurred-image hero__blurred-image--desktop"
        data-testid="hero-blurred-image-desktop"
      >
        {{ media_blurred }}
      </div>
  {% endif %}

  <div
    class="hero__container spacing-style section section--full-width"
    style="{% render 'spacing-style', settings: section.settings %}"
  >
    {%- if section.settings.link != blank -%}
      <a
        href="{{ section.settings.link }}"
        class="hero__link"
        {% if section.settings.open_in_new_tab %}
          target="_blank" rel="noopener"
        {% endif %}
      ></a>
    {%- endif -%}
    
    <div
      class="hero__media-wrapper"
      style="--hero-media-count: {{ media_count }};--hero-media-count-mobile: {{ media_count_mobile }};"
      data-testid="hero-media-wrapper"
      data-carousel="true"
    >
      {% liquid
        if section.settings.toggle_overlay
          render 'overlay', settings: section.settings
        endif
      %}
      <div class="hero__carousel-container">
        {{ media }}
      </div>
    </div>
    
    <div
      class="
        hero__content-wrapper
        layout-panel-flex
        layout-panel-flex--{{ section.settings.content_direction }}
        {% if section.settings.vertical_on_mobile %}mobile-column{% endif %}
        section-content-wrapper
        {{section.settings.section_width}}
        {% if request.design_mode %}hero__content-wrapper--design-mode{% endif %}
      "
      style="{% render 'layout-panel-style', settings: section.settings %}"
    >
      
      {%- comment -%} 
        1. Render Static Blocks (Fixed)
        If you have other blocks like 'text' or 'button' that should stay visible always.
      {%- endcomment -%}
      {% for block in section.blocks %}
        {% if block.type != 'slide' %}
          <div class="hero__static-block" {{ block.shopify_attributes }}>
            {% case block.type %}
              {% when 'text' %}
                 <div class="hero__text {{ block.settings.text_style }}">
                   {{ block.settings.text }}
                 </div>
              {% when 'button' %}
                 {% render 'button', link: block.settings.link, label: block.settings.label %}
              {% when 'spacer' %}
                 <div style="height: {{ block.settings.pixel_size }}px"></div>
            {% endcase %}
          </div>
        {% endif %}
      {% endfor %}

      {%- comment -%} 
        2. Bottom Left Content Container (Text, Button, Indicators)
        All vertically aligned at bottom left
      {%- endcomment -%}
      <div class="hero__bottom-left-container">
        {%- for block in slides -%}
          <div class="hero__bottom-left-content" style="--bottom-left-text-max-width: {{ block.settings.text_max_width }}px;">
            {%- if block.settings.heading != blank -%}
              <div class="hero__bottom-left-text">
                {{ block.settings.heading }}
              </div>
            {%- endif -%}
            {%- if block.settings.button_label != blank -%}
              {%- if block.settings.button_link != blank -%}
                <a href="{{ block.settings.button_link }}" class="hero__bottom-left-button" {% if block.settings.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}>
                  {{ block.settings.button_label }}
                </a>
              {%- else -%}
                <span class="hero__bottom-left-button">
                  {{ block.settings.button_label }}
                </span>
              {%- endif -%}
            {%- endif -%}
          </div>
        {%- endfor -%}

        {%- comment -%} 3. Carousel indicators (dots) {%- endcomment -%}
        {% if media_count > 1 %}
          <div class="hero__indicators" aria-hidden="false">
            {% for i in (1..media_count) %}
              <button class="hero__indicator{% if forloop.index0 == 0 %} indicator-active{% endif %}" data-index="{{ forloop.index0 }}" aria-label="Slide {{ forloop.index }}"></button>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    </div>
  </div>
</div>

{% stylesheet %}
  .hero-wrapper { --hero-height-offset: 0px; }
  body:has(> #header-group > .header-section > #header-component) .hero-wrapper:first-child {
    --hero-height-offset: var(--header-group-height, 0);
  }
  .hero { position: relative; min-height: calc(var(--hero-min-height) - var(--hero-height-offset)); }
  .hero[data-shopify-visual-preview] { --hero-min-height: 600px; min-height: 600px; }
  .hero__container {
    position: relative;
    overflow: hidden;
    border: var(--hero-border-width) var(--hero-border-style) rgb(var(--color-border-rgb) / var(--hero-border-opacity));
    min-height: inherit;
    align-items: var(--vertical-alignment-mobile);
    justify-content: var(--horizontal-alignment);
    z-index: var(--layer-base);
    @media screen and (min-width: 750px) { align-items: var(--vertical-alignment); }
  }
  .hero__content-wrapper.page-width { grid-column: 2 / 3; }
  .hero__content-wrapper { position: relative; inset: 0; z-index: var(--layer-flat); display: flex; flex-direction: column; }
  
  .hero__media-wrapper {
    position: absolute; inset: 0; display: grid; grid-column: 1 / -1;
    grid-template-columns: repeat(var(--hero-media-count, 1), 1fr);
  }
  .hero__carousel-container { position: absolute; inset: 0; width: 100%; height: 100%; }
  
  .hero__carousel-container > :is(.hero__image, .hero__video, .hero__video-wrapper, svg) {
    position: absolute; inset: 0; width: 100%; height: 100%;
    opacity: 0; transition: opacity 0.5s ease-in-out;
  }
  .hero__carousel-container > :is(.hero__image, .hero__video, .hero__video-wrapper, svg).carousel-active { opacity: 1; }

  .hero__image, .hero__video, .hero__video-poster {
    height: 100%; width: 100%; object-fit: cover; object-position: center center;
    overflow: hidden; position: relative; z-index: var(--layer-base);
  }

  .hero__image--mobile { display: none; }
  .hero__image--desktop { display: block; }
  @media screen and (max-width: 749px) {
    .hero__image--desktop { display: none; }
    .hero__image--mobile { display: block; }
    .hero__media-wrapper { grid-template-columns: repeat(var(--hero-media-count-mobile, 1), 1fr); }
  }

  .hero__link { position: absolute; inset: 0; grid-column: 1 / -1; }
  .hero__media-wrapper, .hero__content-wrapper { pointer-events: none; }
  .hero__media-wrapper :is(a, button, input, textarea, select), 
  .hero__content-wrapper :is(a, button, input, textarea, select) { pointer-events: auto; }

  /* Bottom Left Container - Vertically aligned content */
  .hero__bottom-left-container {
    position: absolute;
    bottom: 25%;
    left: 30px;
    z-index: var(--layer-flat);
    pointer-events: none;
    min-width: 400px;
    align-items: start;
  }

  /* Individual slide content (text + button) - absolutely positioned to prevent layout shift */
  .hero__bottom-left-content {
    position: absolute;
    top: 0;
    left: 0;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
    max-width: min(var(--bottom-left-text-max-width, 300px), calc(100% - 40px));
    width: max-content;
    min-width: 0;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    pointer-events: none;
  }

  .hero__bottom-left-content.carousel-active {
    opacity: 1;
    pointer-events: auto;
    cursor : pointer;
    z-index: 9999;
  }

  /* Text styling */
  .hero__bottom-left-text {
    color: #ffffff;
    pointer-events: none;
    word-wrap: break-word;
    overflow-wrap: break-word;
    max-width: 100%;
  }

  /* Button styling */
  .hero__bottom-left-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    color: #ffffff;
    text-decoration: underline;
    border-radius: 4px;
    letter-spacing: 0.5px;
    pointer-events: auto;
    transition: background 0.2s ease;
    max-width: 100%;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .hero__bottom-left-button:hover {
    opacity: 0.8;
  }

  .hero__bottom-left-button--disabled {
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
  }

  /* Indicators - positioned with safe top margin to always be below content */
  .hero__indicators {
    position: absolute;
    top: 120px; /* Position well below content area - adjust if content is taller */
    left: 0;
    display: flex;
    gap: 8px;
    pointer-events: auto;
  }

  .hero__indicator {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.5);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .hero__indicator.indicator-active {
    background: #ffffff;
  }

  .hero__bottom-left-content :is(a, button, input, textarea, select) {
    pointer-events: auto;
  }

  @media screen and (max-width: 749px) {
    .hero__bottom-left-container {
      bottom: 25%;
      left: 16px;
      font-size: 16px;
    }

    .hero__bottom-left-content {
      max-width: 100%;
    }

    .hero__bottom-left-text {
      font-size: clamp(0.875rem, 2.5vw, 1.5rem);
      line-height: 1.3;
    }

    .hero__bottom-left-button {
      font-size: clamp(0.75rem, 2vw, 1rem);
      cursor:pointer;
    }

    .hero__indicators {
      top: 100px; /* Adjusted for mobile */
    }
  }

  .hero__shop-now {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 8px 12px; background: rgba(0,0,0,0.6); color: #fff; text-decoration: none;
    border-radius: 6px; font-weight: 600; pointer-events: auto;
  }
  .hero__shop-now:hover { background: rgba(0,0,0,0.75); }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('[data-carousel="true"]');
    if (!carousel) return;

    const container = carousel.querySelector('.hero__carousel-container');
    if (!container) return;

    const items = container.querySelectorAll(':scope > :is(.hero__image, .hero__video, .hero__video-wrapper, svg)');
    // Find content items within the section
    const sectionContainer = carousel.closest('.hero__container');
    const contentItems = sectionContainer.querySelectorAll('.hero__bottom-left-content');
    const indicators = sectionContainer.querySelectorAll('.hero__indicator');

    if (items.length <= 1 && contentItems.length === 0 && indicators.length === 0) return;

    let currentIndex = 0;

    function showItem(index) {
      items.forEach((item, i) => {
        item.classList.toggle('carousel-active', i === index);
      });
      
      contentItems.forEach((content, i) => {
        content.classList.toggle('carousel-active', i === index);
      });
      
      if (indicators && indicators.length) {
        indicators.forEach((dot, i) => {
          dot.classList.toggle('indicator-active', i === index);
        });
      }
    }

    function nextItem() {
      currentIndex = (currentIndex + 1) % items.length;
      showItem(currentIndex);
    }

    showItem(0);
    let rotateTimer = setInterval(nextItem, 5000);

    if (indicators && indicators.length) {
      indicators.forEach((btn) => {
        btn.addEventListener('click', (event) => {
          const idx = parseInt(btn.dataset.index, 10);
          if (Number.isFinite(idx)) {
            currentIndex = idx;
            showItem(currentIndex);
            clearInterval(rotateTimer);
            rotateTimer = setInterval(nextItem, 5000);
          }
        });
      });
    }
  });
{% endjavascript %}

{% schema %}
{
  "name": "t:names.hero",
  "tag": "section",
  "class": "hero-wrapper section-wrapper",
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile Image"
        },
        {
          "type": "richtext",
          "id": "heading",
          "label": "Slide Heading"
        },
        {
          "type": "range",
          "id": "text_max_width",
          "label": "Heading Max Width",
          "min": 100,
          "max": 600,
          "step": 50,
          "unit": "px",
          "default": 300
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "SHOP NOW"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Open Button Link in New Tab",
          "default": false
        }
      ]
    },
    {
      "type": "text",
      "name": "Static Text",
      "settings": [
         { "type": "richtext", "id": "text", "label": "Text" },
         { "type": "text", "id": "text_style", "label": "Style Class" }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "settings": [
         { "type": "url", "id": "link", "label": "Link" },
         { "type": "text", "id": "label", "label": "Label" }
      ]
    },
    {
      "type": "spacer",
      "name": "Spacer",
      "settings": [
         { "type": "range", "id": "pixel_size", "min": 0, "max": 100, "step": 1, "label": "Height (px)", "default": 20 }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "t:content.section_link"
    },
    {
      "type": "url",
      "id": "link",
      "label": "t:settings.link"
    },
    {
      "type": "checkbox",
      "id": "open_in_new_tab",
      "label": "t:settings.open_new_tab",
      "default": false
    },
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "select",
      "id": "content_direction",
      "label": "t:settings.direction",
      "options": [
        { "value": "column", "label": "t:options.vertical" },
        { "value": "row", "label": "t:options.horizontal" }
      ],
      "default": "column"
    },
    {
      "type": "checkbox",
      "id": "vertical_on_mobile",
      "label": "t:settings.vertical_on_mobile",
      "default": true,
      "visible_if": "{{ section.settings.content_direction == 'row' }}"
    },
    {
      "type": "select",
      "id": "horizontal_alignment",
      "label": "t:settings.alignment",
      "options": [
        { "value": "flex-start", "label": "t:options.left" },
        { "value": "center", "label": "t:options.center" },
        { "value": "flex-end", "label": "t:options.right" },
        { "value": "space-between", "label": "t:options.space_between" }
      ],
      "default": "flex-start",
      "visible_if": "{{ section.settings.content_direction == 'row' }}"
    },
    {
      "type": "select",
      "id": "vertical_alignment",
      "label": "t:settings.position",
      "options": [
        { "value": "flex-start", "label": "t:options.top" },
        { "value": "center", "label": "t:options.center" },
        { "value": "flex-end", "label": "t:options.bottom" }
      ],
      "default": "center",
      "visible_if": "{{ section.settings.content_direction == 'row' }}"
    },
    {
      "type": "select",
      "id": "horizontal_alignment_flex_direction_column",
      "label": "t:settings.alignment",
      "options": [
        { "value": "flex-start", "label": "t:options.left" },
        { "value": "center", "label": "t:options.center" },
        { "value": "flex-end", "label": "t:options.right" }
      ],
      "default": "flex-start",
      "visible_if": "{{ section.settings.content_direction != 'row' }}"
    },
    {
      "type": "select",
      "id": "vertical_alignment_flex_direction_column",
      "label": "t:settings.position",
      "options": [
        { "value": "flex-start", "label": "t:options.top" },
        { "value": "center", "label": "t:options.center" },
        { "value": "flex-end", "label": "t:options.bottom" },
        { "value": "space-between", "label": "t:options.space_between" }
      ],
      "default": "center",
      "visible_if": "{{ section.settings.content_direction == 'column' }}"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.width",
      "options": [
        { "value": "page-width", "label": "t:options.page" },
        { "value": "full-width", "label": "t:options.full" }
      ],
      "default": "page-width"
    },
    {
      "type": "select",
      "id": "section_height",
      "label": "t:settings.height",
      "options": [
        { "value": "auto", "label": "t:options.auto" },
        { "value": "small", "label": "t:options.small" },
        { "value": "medium", "label": "t:options.medium" },
        { "value": "large", "label": "t:options.large" },
        { "value": "full-screen", "label": "t:options.full_screen" },
        { "value": "custom", "label": "t:options.custom" }
      ],
      "default": "medium"
    },
    {
      "type": "range",
      "id": "section_height_custom",
      "label": "t:settings.custom_height",
      "min": 0, "max": 100, "step": 1, "default": 50, "unit": "%",
      "visible_if": "{{ section.settings.section_height == 'custom' }}"
    },
    {
      "type": "header",
      "content": "t:content.appearance"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "toggle_overlay",
      "label": "t:settings.media_overlay"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "t:settings.overlay_color",
      "alpha": true,
      "default": "#00000026",
      "visible_if": "{{ section.settings.toggle_overlay }}"
    },
    {
      "type": "select",
      "id": "overlay_style",
      "label": "t:settings.overlay_style",
      "options": [
        { "value": "solid", "label": "t:options.solid" },
        { "value": "gradient", "label": "t:options.gradient" }
      ],
      "default": "solid",
      "visible_if": "{{ section.settings.toggle_overlay }}"
    },
    {
      "type": "select",
      "id": "gradient_direction",
      "label": "t:settings.gradient_direction",
      "options": [
        { "value": "to top", "label": "t:options.up" },
        { "value": "to bottom", "label": "t:options.down" }
      ],
      "default": "to top",
      "visible_if": "{{ section.settings.toggle_overlay and section.settings.overlay_style == 'gradient' }}"
    },
    {
      "type": "checkbox",
      "id": "blurred_reflection",
      "label": "t:settings.blurred_reflection",
      "default": false
    },
    {
      "type": "range",
      "id": "reflection_opacity",
      "label": "t:settings.reflection_opacity",
      "min": 0, "max": 100, "step": 1, "unit": "%",
      "default": 75,
      "visible_if": "{{ section.settings.blurred_reflection }}"
    }
  ],
  "presets": [
    {
      "name": "t:names.hero",
      "blocks": [
        {
          "type": "slide"
        },
         {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}